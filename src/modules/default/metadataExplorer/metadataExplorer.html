<template>
  <div class="slds-p-around_medium slds-text-color_default">
    <lightning-card title="Metadata Explorer">
      <template lwc:if={renderRetrieve}>
        <lightning-button
          label="Retrieve"
          slot="actions"
          onclick={handleRetrieveClick}
        ></lightning-button>
      </template>
      <lightning-button-icon-stateful
        icon-name="utility:filterList"
        selected={filterState}
        onclick={handleFilterButtonClick}
        alternative-text="filter"
        class="slds-p-horizontal_medium"
        slot="actions"
      ></lightning-button-icon-stateful>
      <template lwc:if={metadataTypeOptions}>
        <lightning-combobox
          name="selectedMetadataType"
          label="Select Metadata Type"
          value={selectedMetadataTypeValue}
          options={metadataTypeOptions}
          onchange={handleMetadataTypeSelection}
          class="slds-m-around_medium"
        ></lightning-combobox>
      </template>
      <template lwc:if={filterState}>
        <lightning-layout horizontal-align="space">
          <lightning-layout-item flexibility="auto" padding="around-small">
            <lightning-input
              type="text"
              label="Component Name"
              onchange={handleComponentNameChange}
            >
            </lightning-input>
          </lightning-layout-item>
          <lightning-layout-item flexibility="auto" padding="around-small">
            <lightning-input
              type="text"
              label="User Name"
              onchange={handleUserNameChange}
            >
            </lightning-input>
          </lightning-layout-item>
          <lightning-layout-item flexibility="auto" padding="around-small">
            <default-time-zone
              value={selectedTimeZone}
              ontimezonechange={handleTimeZoneChange}
            ></default-time-zone>
            <lightning-input
              type="datetime"
              label="From"
              timezone={selectedTimeZone}
              onchange={handleFromChange}
            >
            </lightning-input>
            <lightning-input
              type="datetime"
              label="To"
              timezone={selectedTimeZone}
              onchange={handleToChange}
            >
            </lightning-input>
          </lightning-layout-item>
        </lightning-layout>
      </template>

      <template lwc:if={rows}>
        <lightning-tree-grid
          data={rows}
          columns={columns}
          key-field="id"
          onrowselection={handleRowSelection}
          ontoggle={handleToggle}
        >
        </lightning-tree-grid>
      </template>
      <p class="slds-hidden">
        processedMetadataTypes : {processedMetadataTypes}
      </p>
      <template lwc:if={orgConnectionInfo}>
        <div slot="footer">
          <p><b>URL:</b> {orgConnectionInfo.result.instanceUrl}</p>
          <p><b>username:</b> {orgConnectionInfo.result.username}</p>
          <p><b>orgName:</b> {orgConnectionInfo.result.orgName}</p>
          <p><b>edition:</b> {orgConnectionInfo.result.edition}</p>
        </div>
      </template>
    </lightning-card>
    <template lwc:if={spinnerDisplayText}>
      <div class="slds-backdrop slds-backdrop_open">
        <div class="slds-spinner_container">
          <div
            class="slds-spinner_brand slds-spinner slds-spinner_large slds-is-relative"
          >
            <span class="slds-assistive-text">Loading</span>
            <div class="slds-spinner__dot-a"></div>
            <div class="slds-spinner__dot-b"></div>
          </div>

          <div class="slds-spinner-text slds-p-top_large">
            <ul>
              <template for:each={spinnerDisplayText} for:item="item">
                <li key={item}>{item}</li>
              </template>
            </ul>
          </div>
        </div>
      </div>
    </template>
  </div>
  <div class="slds-hidden">{refreshView}</div>
</template>
